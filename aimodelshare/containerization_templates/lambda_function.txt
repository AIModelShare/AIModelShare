# SET ENVIRONMENT VARIALBES FOR BUCKETS

# "bucket": "codebuild-bucket",
# "key": "modfunction161070.zip",
# "directory": "modfunction161070"

import sys
import os
import json
import zipfile
import tempfile
import boto3

#temp_path = tempfile.gettempdir()

#bucket = os.getenv("bucket")
#api_id = os.getenv("api_id")
#directory = os.getenv("directory")

#key = api_id + "/" + directory + ".zip"
#temp_path_directory = "/".join([temp_path, directory])
#temp_path_directory_zip_file = temp_path_directory + ".zip"

s3_client = boto3.client('s3')
response = s3_client.download_file(
  os.getenv("bucket"),
  os.getenv("api_id") + "/" + os.getenv("directory") + ".zip",
  "/".join([tempfile.gettempdir(), os.getenv("directory")]) + ".zip"
)

with zipfile.ZipFile("/".join([tempfile.gettempdir(), os.getenv("directory")]) + ".zip", 'r') as zip_ref:
    zip_ref.extractall(os.getenv("directory"))

sys.path.append("/".join([tempfile.gettempdir(), os.getenv("directory")]))

from model import handler

def lambda_handler(event, context):
    result = handler(event, context)
    return result
