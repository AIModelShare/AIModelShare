# SET ENVIRONMENT VARIALBES FOR BUCKETS

# "bucket": "codebuild-bucket",
# "key": "modfunction161070.zip",
# "directory": "modfunction161070"

import sys
import os
import json
import zipfile
import tempfile
import boto3

temp_path = tempfile.gettempdir()

bucket = os.getenv("bucket")
api_id = os.getenv("api_id")
directory = os.getenv("directory")

key = api_id + "/" + directory + ".zip"
temp_path_directory = "/".join([temp_path, directory])
temp_path_directory_zip_file = temp_path_directory + ".zip"

s3_client = boto3.client('s3')
response = s3_client.download_file(
  bucket,
  key,
  temp_path_directory_zip_file
)

with zipfile.ZipFile(temp_path_directory_zip_file, 'r') as zip_ref:
    zip_ref.extractall(directory)

sys.path.append(temp_path_directory)

from model import handler

def lambda_handler(event, context):
    result = handler(event, context)
    return result
